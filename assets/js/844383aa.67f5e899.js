"use strict";(self.webpackChunk_jitsi_handbook=self.webpackChunk_jitsi_handbook||[]).push([[1837],{2744:(e,o,i)=>{i.r(o),i.d(o,{assets:()=>a,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>l});var n=i(4848),t=i(8453);const r={id:"devops-guide-region",title:"Region-based setup"},s=void 0,d={id:"devops-guide/devops-guide-region",title:"Region-based setup",description:"Configuration for region-based setup",source:"@site/docs/devops-guide/region.md",sourceDirName:"devops-guide",slug:"/devops-guide/devops-guide-region",permalink:"/handbook/docs/devops-guide/devops-guide-region",draft:!1,unlisted:!1,editUrl:"https://github.com/jitsi/handbook/edit/master/docs/devops-guide/region.md",tags:[],version:"current",lastUpdatedAt:1768480403e3,frontMatter:{id:"devops-guide-region",title:"Region-based setup"},sidebar:"docs",previous:{title:"Log Analyser",permalink:"/handbook/docs/devops-guide/devops-guide-log-analyser"},next:{title:"Configuration",permalink:"/handbook/docs/category/configuration"}},a={},l=[{value:"Configuration for region-based setup",id:"configuration-for-region-based-setup",level:2},{value:"User region detection",id:"user-region-detection",level:2},{value:"How it works",id:"how-it-works",level:2}];function c(e){const o={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.h2,{id:"configuration-for-region-based-setup",children:"Configuration for region-based setup"}),"\n",(0,n.jsx)(o.p,{children:"This approach allows jicofo to recognize the region of a participant and then choose a bridge for them based on that. To set this up:"}),"\n",(0,n.jsxs)(o.ul,{children:["\n",(0,n.jsx)(o.li,{children:"Jicofo: enable RegionBasedBridgeSelectionStrategy and set jicofo.local-region to jicofo's region"}),"\n",(0,n.jsx)(o.li,{children:"JVB: set videobridge.relay.region to the local region"}),"\n",(0,n.jsxs)(o.li,{children:["prosody: enable the ",(0,n.jsx)(o.code,{children:"jiconop"}),", ",(0,n.jsx)(o.code,{children:"muc_meeting_id"}),", and ",(0,n.jsx)(o.code,{children:"jitsi_session"})," modules and set region_name to the local region"]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"user-region-detection",children:"User region detection"}),"\n",(0,n.jsx)(o.p,{children:"For your global deployment we assume you are using some sort of DNS routing from a cloud provider. At some point on your ingress add the 'X-Proxy-Region' HTTP header with the region name to the request, and forward that to the shard. This header will be handled and sent to jicofo. Some cloud providers have a feature like this built in. If you have to add the proxy yourself, you can add a regional nginx reverse proxy or HAProxy in front of your shards that adds this header."}),"\n",(0,n.jsx)(o.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,n.jsx)(o.p,{children:"On the shard, the request to /xmpp-websocket will go through nginx. On participant join, prosody will extract the region and add it to the participant presence, which will be seen by jicofo."}),"\n",(0,n.jsxs)(o.p,{children:["That region will be in the self-presence of the participant and the client will add it to the config.deploymentInfo (for debugging purposes).\nAfter connection ",(0,n.jsx)(o.code,{children:"jiconop"})," will send the client the shard and region information, both will end up in the config.deploymentInfo."]}),"\n",(0,n.jsx)(o.p,{children:"There is also a stat fired from ljm to jitsi-meet. The value of this is visible in the local user stats in the UI (when you hover over the gsm bars) - serverRegion. This is the region of the bridge that is assigned by jicofo."})]})}function h(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,o,i)=>{i.d(o,{R:()=>s,x:()=>d});var n=i(6540);const t={},r=n.createContext(t);function s(e){const o=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),n.createElement(r.Provider,{value:o},e.children)}}}]);